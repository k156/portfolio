1. 학생, 과목, 교수, 수강내역 테이블을 관계를 고려하여 생성하는 DDL을 작성하시오.
----------------------------------------------------------------------
CREATE TABLE `Student` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(32) NOT NULL,
  `addr` varchar(30) DEFAULT NULL,
  `birth` date DEFAULT NULL,
  `tel` varchar(15) DEFAULT NULL,
  `email` varchar(31) DEFAULT NULL,
  `regdt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `gender` tinyint(1) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id_UNIQUE` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=1005 DEFAULT CHARSET=utf8;


CREATE TABLE `Subject` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(31) DEFAULT NULL,
  `prof` smallint(5) unsigned DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `uq_subject_name` (`name`),
  KEY `Subject_ibfk_prof_idx` (`prof`),
  CONSTRAINT `Subject_ibfk_prof` FOREIGN KEY (`prof`) REFERENCES `Prof` (`id`) ON DELETE SET NULL ON UPDATE NO ACTION
) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8;


CREATE TABLE `Prof` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(31) DEFAULT NULL,
  `likecnt` int(11) DEFAULT '0',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=101 DEFAULT CHARSET=utf8;


CREATE TABLE `Enroll` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `subject` smallint(5) unsigned NOT NULL,
  `student` int(10) unsigned NOT NULL,
  PRIMARY KEY (`id`),
  KEY `Enroll_ibfk_2` (`student`),
  KEY `Enroll_ibfk_1_idx` (`subject`),
  CONSTRAINT `Enroll_ibfk_1` FOREIGN KEY (`subject`) REFERENCES `Subject` (`id`) ON DELETE CASCADE ON UPDATE NO ACTION,
  CONSTRAINT `Enroll_ibfk_2` FOREIGN KEY (`student`) REFERENCES `Student` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=2046 DEFAULT CHARSET=utf8;




2.학생테이블과 과목테이블을 활용하여, 수강내역 테이블에 테스트용 데이터를 구성하는 DML을 절차적으로 작성하시오.
-------------------------------------------------------------------------------------------------------------
insert into Enroll(student, subject)
 select id, (select id from Subject order by rand() limit 1) sid from Student order by id;

insert into Enroll(student, subject)
 select id, (select id from Subject order by rand() limit 1) sid from Student order by rand() limit 500
 on duplicate key update student = student;
 
insert into Enroll(student, subject)
 select id, (select id from Subject order by rand() limit 1) sid from Student order by rand() limit 500
 on duplicate key update student = student;
 
 
 
3.동아리(Club)별 회원 테이블(ClubMember)을 다음과 같이 만들고, 동아리별 50명 내외로 가입시키시오. (단, Club 테이블의 leader 컬럼은 삭제하고, 리더를 회원테이블의 레벨 2로 등록하시오.)
-----------------------------------------------------------------------------------------------------------------------

#ClubMember 테이블 생성
CREATE TABLE `dooodb`.`ClubMember` (
  `id` SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `club` VARCHAR(31) NOT NULL,
  `student` INT NULL,
  `level` TINYINT(0) NULL DEFAULT 0 ,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `id_UNIQUE` (`id` ASC),
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8
COLLATE = utf8_unicode_ci;


START TRANSACTION;
#ClubMember에 클럽이름, 클럽장 입력하기
insert into ClubMember(club) select name from Club order by id;
insert into ClubMember(student) select leader from Club order by id;
update ClubMember set level = 2 where id between 1 and 3;
select * from ClubMember;

#ClubMember에 클럽간부 입력하기 
insert into ClubMember(student, club)
select id, (select id from Club order by rand() limit 1) from Student order by id limit 10
on duplicate key update student = student;
update ClubMember set level = 1 where id > 3; 
select * from ClubMember;

#ClubMember에 클럽회원 입력하기 
insert into ClubMember(student, club)
select id, (select id from Club order by rand() limit 1) from Student order by id limit 40
on duplicate key update student = student;
update ClubMember set level = 0 where id > 21; 
select * from ClubMember;

# Club 테이블에서 leader 삭제
ALTER TABLE `dooodb`.`Club` 
DROP FOREIGN KEY `Club_ibfk_1`;
ALTER TABLE `dooodb`.`Club` 
DROP INDEX `fk_leader_student`;

Alter table Club drop leader;
select * from Club;

#ClubMember 테이블에 FK 추가
  
ALTER TABLE `dooodb`.`ClubMember` 
CHANGE COLUMN `club` `club` SMALLINT UNSIGNED NULL DEFAULT NULL ,
CHANGE COLUMN `student` `student` INT(11) UNSIGNED NULL DEFAULT NULL ;

ALTER TABLE ClubMember ADD Constraint FOREIGN KEY (student) REFERENCES Student(id);
ALTER TABLE ClubMember ADD Constraint FOREIGN KEY (club) REFERENCES Club(id);

select * from ClubMember;

COMMIT;


select * from Dept;


4. 학과 테이블(Dept)을 만들고 5개 학과 이상 샘플 데이터를 등록하고, 학생 테이블에 학과 칼럼(dept)을 추가한 후 모든 학생에 대해 랜덤하게 과 배정을 시키시오.
 
# 학과 테이블 생성
CREATE TABLE `dooodb`.`Dept` (
  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(31) NOT NULL,
  `prof` SMALLINT(5) UNSIGNED NULL,
  `student` INT(11) UNSIGNED NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `id_UNIQUE` (`id` ASC),
  UNIQUE INDEX `name_UNIQUE` (`name` ASC))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8
COLLATE = utf8_unicode_ci;

Alter table Dept ADD constraint foreign key (prof) references Prof(id);
Alter table Dept ADD constraint foreign key (student) references Student(id);

START TRANSACTION;

#학과 샘플데이터 등록
insert into Dept (name) values ('생명과학과');
insert into Dept (name) values ('생명공학과');
insert into Dept (name) values ('화공생명공학과');
insert into Dept (name) values ('농생물학과');
insert into Dept (name) values ('생명자원학과');

select * from Dept;



# 과대표 추가
update Dept d set student = (select id from Student where dept = d.id order by rand() limit 1);
select * from Dept;

#지도교수 추가
update Dept set prof = (select id from Prof order by rand() limit 1) where prof > 0;
select * from Dept;


#학생 테이블에 학과 컬럼 추가
Alter table Student Add column dept int after gender;
desc Student;


#랜덤하게 과 배정
Update Student set dept = (select id from Dept order by rand() limit 1) where id > 0;
#과별 학생수
select dept, count(*) from Student group by dept;
# 동일학과에 중복학생 존재 여부 체크
select dept, id from Student group by dept, id having count(*) >1;


Commit;

  
  
5. 강의실 테이블(Classroom)을 만들고, 샘플 강의실 10개를 등록하고, 과목별 강의실 배치를 위해 과목(Subject) 테이블에 강의실 컬럼(Classroom) 추가한 후 배정하시오.
  
  CREATE TABLE `dooodb`.`Classroom` (
  `id` SMALLINT NOT NULL AUTO_INCREMENT,
  `room_num` SMALLINT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `id_UNIQUE` (`id` ASC),
  UNIQUE INDEX `room_num_UNIQUE` (`room_num` ASC))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8
COLLATE = utf8_unicode_ci;


select * from Classroom;

# 샘플강의실 등록
insert into Classroom (room_num) values (101);
insert into Classroom (room_num) values (102);
insert into Classroom (room_num) values (103);
insert into Classroom (room_num) values (104);
insert into Classroom (room_num) values (105);
insert into Classroom (room_num) values (106);
insert into Classroom (room_num) values (107);
insert into Classroom (room_num) values (108);
insert into Classroom (room_num) values (109);
insert into Classroom (room_num) values (110);


# Subject 테이블에 Classroom 컬럼 추가
Alter table Subject add column classroom smallint;
desc Subject;

#강의실 배정
update Subject set classroom = (select room_num from Classroom order by rand() limit 1) where id > 0;
select * from Subject;
